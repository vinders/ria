(function(b){var e,k,q,s,f=b("#container"),x=b(".searchIcon"),t=b("#searchZone"),A=b("#searchZone input"),B=b("#searchZone button"),C=function(a){q=a.target.getAttribute("value");window.localStorage.setItem("filterSeen",q);document.getElementById("filterSetting").removeAttribute("id");b("#filter"+q+"+label").attr("id","filterSetting")},m=function(a,d){b.ajax({dataType:"jsonp",data:{key:"d57266536e0a"},url:"http://api.betaseries.com"+a,type:"POST",success:function(b){d.apply(null,[b])}})},y=function(){f.append("<section><h2>Aucune s\u00e9rie ajout\u00e9e.</h2><p>Ajoutez-en via une recherche, puis d\u00e9finissez votre \u00e9pisode actuel en cliquant sur la s\u00e9rie ajout\u00e9e, puis en cliquant sur l'\u00e9pisode de votre choix.</p></section>")}, F=function(a){a.preventDefault();var d=b(this).parent(),c=b(this).parent().attr("id");a=b(this).attr("href");var e=b("#"+c+" .season"),f=b("#"+c+" .episode");0<b("#"+c+" .seasonItem").length?b("#"+c+">ol").toggle():(d.append('<img id="loader" src="data:image/gif;base64,R0lGODlhFAAGAPIEAHt7e8/Pzz5hfbjS5////wAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUP8/eHBhY2tldCBiZWdpbj0i72lkOkQ4ODdEQjRGNUVERDExRTI4MEE0QTA3MTZDQTJFMTc4Ij4gPHhtcE1NOkS/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEBRQABAAsAAAAABQABgAAAyQ4uhT+7bkhqhgNaBDyDpSFBRvnaaB1nSb5hdVYdi66MJITSQkAIfkEBRQABAAsAAAAAA0ABgAAAxoYujT+AUgQmrhixFkHzpvUfdpEWZi2KM3jJAAh+QQFFAAEACwHAAAADQAGAAADGhi6NP4BSBCauGLEWQfOm9R92kRZmLYozeMkACH5BAUUAAIALA4AAAAGAAYAAAIKjB+gYMu5WkSmAAA7" alt="loader" />'), m("/shows/episodes/"+a+".json",function(a){d.append("<ol></ol>");b("#loader").remove();for(var g=0;g<a.root.seasons.length;g++){var l="",n=c+"-"+g.toString();(g+1).toString()===e.text()&&(l=' class="currentSeason"');b("#"+c+">ol").append('<li id="'+n+'" class="seasonItem"><h3'+l+">Saison "+a.root.seasons[g].number+'</h3><ol class="episodesList"></ol></li>');for(l=0;l<a.root.seasons[g].episodes.length;l++){var p="";(g+1).toString()===e.text()&&(l+1).toString()===f.text()&&(p=' class="currentEpisode"'); b("#"+n+" .episodesList").append('<li id="'+n+"-"+l.toString()+'"'+p+"><em>"+(l+1).toString()+" -</em> "+a.root.seasons[g].episodes[l].title+"</li>");document.getElementById(n+"-"+l.toString()).addEventListener("click",D,!1)}b("#"+n+" h3").on("click",E)}b(".episodesList").hide()}))},E=function(){b(this).parent().find("ol").toggle()},z=function(a){var d,c,e;"dashboard"===s?(d='<section id="advice"><p class="adviceTitle">Suggestion</p><p>',c='</p><img src="'+a.root.show.banner+'" alt="" /></section>', e=f):(d="<li>",c="</li>",e=b("#shows"));e.append(d+'<a class="hidden" href="'+a.root.show.url+'">'+a.root.show.banner+"</a><h2>"+a.root.show.title+'</h2><button class="addShow">Ajouter</button><p>'+a.root.show.description+'</p><strong class="hidden">'+a.root.show.seasons[1].length+'</strong><div class="tv">'+a.root.show.network+"</div>"+c);if("dashboard"===s)b("#advice button").on("click",u)},u=function(a){a.preventDefault();var d=b(this).parent();a=d.find("a").attr("href");for(var c=d.find("h2").text(), r=d.find("a").text(),j=d.find("strong").text(),d=d.find(".tv").text(),h=0;h<e.length;h++)if(e[h].url===a)return f.empty(),f.append("<section><p>Cette s\u00e9rie a d\u00e9j\u00e0 \u00e9t\u00e9 ajout\u00e9e.</p></section>"),!1;e.push({url:a,title:c,banner:r,season:1,episode:1,nbmax:j,tvdb:d});window.localStorage.setItem("shows",JSON.stringify(e));window.location.href="./series.html"},G=function(a){a.preventDefault();a=b(this).parent().attr("id");var d=parseInt(a.substr(4),10)-1,c=b("#"+a);a=c.find("h2").text(); b("body").append('<div id="dialog"><div><h2>Confirmer suppression&nbsp:</h2><h3>'+a+'</h3><button id="dialogConfirm">Supprimer</button><button id="dialogCancel">Annuler</button></div></div>');b("#dialog").hide().fadeIn(150);b("#dialogConfirm").on("click",function(){--k;e.splice(d,1);window.localStorage.setItem("shows",JSON.stringify(e));b("#dialog").fadeOut("150",function(){b(this).remove()});c.animate({height:0,minHeight:0,maxHeight:0},200,function(){b(this).remove();0===k&&y();window.location.reload(!1)})}); b("#dialogCancel").on("click",function(){b("#dialog").fadeOut("150",function(){b(this).remove()})})},D=function(a){a.preventDefault();var d=a.target.getAttribute("id").split("-"),c=d[0];a=d[1];var d=d[2],f=b(this).parent().find("li").length,j=b("#"+c+" .season"),h=b("#"+c+" .episode");b("#"+c+" .currentSeason").removeAttr("class");b("#"+c+" .currentEpisode").removeAttr("class");b(this).parent().parent().find("h3").attr("class","currentSeason");b(this).attr("class","currentEpisode");j.text((parseInt(a, 10)+1).toString());h.text((parseInt(d,10)+1).toString());c=e[parseInt(c.substr(4),10)-1];c.season=parseInt(a,10)+1;c.episode=parseInt(d,10)+1;c.nbmax=f;window.localStorage.setItem("shows",JSON.stringify(e))},H=function(b){b.preventDefault();t.toggle()},I=function(a){a.preventDefault();a=A.attr("value");""!==a&&2<a.length?(f.empty(),s="search",b("#current")[0].removeAttribute("id"),x.attr("id","current"),f.append('<section><p><img id="loader" src="data:image/gif;base64,R0lGODlhFAAGAPIEAHt7e8/Pzz5hfbjS5////wAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUP8/eHBhY2tldCBiZWdpbj0i72lkOkQ4ODdEQjRGNUVERDExRTI4MEE0QTA3MTZDQTJFMTc4Ij4gPHhtcE1NOkS/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEBRQABAAsAAAAABQABgAAAyQ4uhT+7bkhqhgNaBDyDpSFBRvnaaB1nSb5hdVYdi66MJITSQkAIfkEBRQABAAsAAAAAA0ABgAAAxoYujT+AUgQmrhixFkHzpvUfdpEWZi2KM3jJAAh+QQFFAAEACwHAAAADQAGAAADGhi6NP4BSBCauGLEWQfOm9R92kRZmLYozeMkACH5BAUUAAIALA4AAAAGAAYAAAIKjB+gYMu5WkSmAAA7" alt="loader" /> Recherche en cours...</p></section>'), m("/shows/search.json?title="+a,function(a){if(0<a.root.shows.length){f.empty();f.append('<ul id="shows"></ul>');b("#shows");for(var c=0;c<a.root.shows.length&&16>c;c++)m("/shows/display/"+a.root.shows[c].url+".json",z);f.on("click","h2",function(){var a=b(this).parent().find("a").text();b(this).parent().find("p").toggle();"undefined"!==a&&(0===b(this).parent().find("img").length?b(this).parent().append('<img class="banner" src="'+a+'" alt="" />'):b(this).parent().find(".banner").toggle())});f.on("click", ".addShow",u)}else f.empty(),f.append("<section><p>Aucune s\u00e9rie trouv\u00e9e.</p></section>")})):t.append("<span>Veuillez entrer au moins 3 caract\u00e8res</span>")};b(function(){e=null===window.localStorage.getItem("shows")?[]:JSON.parse(window.localStorage.getItem("shows"));q=null===window.localStorage.getItem("filterSeen")?1:window.localStorage.getItem("filterSeen");b("#filter"+q).attr("checked","checked");b("#filter"+q+"+label").attr("id","filterSetting");b("#prefs input").each(function(){b(this).on("click", C)});k=e.length;s=b("#container").attr("class");if(k)switch(s){case "dashboard":var a;1===k?(b("#number").append("<span>1</span> s\u00e9rie suivie"),a=0):(b("#number").append("<span>"+k+"</span> s\u00e9ries suivies"),a=Math.round(Math.random()*(k-1)));var d,c=!1;m("/shows/similar/"+e[a].url+".json",function(b){d=b.root.shows[0];if(void 0!==d)for(b=0;b<e.length;b++)d.url===e[b].url&&(c=!0),b+1===e.length&&!1===c&&m("/shows/display/"+d.url+".json",z)});break;case "shows":f.append('<ul id="shows"></ul>'); a=f.find("ul");for(var r=k;0<r;r--){var j=e[r-1];a.append('<li id="show'+r.toString()+'"><a href="'+j.url+'"><h2>'+j.title+'</h2><img src="'+j.banner+'" alt="" /><span>Saison <em class="season">'+j.season+'</em>, \u00e9pisode <em class="episode">'+j.episode+"</em></span></a><button>Effacer</button></li>")}b("#shows li").each(function(){b(this).children("a").on("click",F);b(this).children("button").on("click",G)});break;case "planning":var h=[],g,l="Janvier F\u00e9vrier Mars Avril Mai Juin Juillet Ao\u00fbt Septembre Octobre Novembre D\u00e9cembre".split(" "), n=new Date,p,w,t,v,u;f.append('<section><p><img id="loader" src="data:image/gif;base64,R0lGODlhFAAGAPIEAHt7e8/Pzz5hfbjS5////wAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUP8/eHBhY2tldCBiZWdpbj0i72lkOkQ4ODdEQjRGNUVERDExRTI4MEE0QTA3MTZDQTJFMTc4Ij4gPHhtcE1NOkS/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEBRQABAAsAAAAABQABgAAAyQ4uhT+7bkhqhgNaBDyDpSFBRvnaaB1nSb5hdVYdi66MJITSQkAIfkEBRQABAAsAAAAAA0ABgAAAxoYujT+AUgQmrhixFkHzpvUfdpEWZi2KM3jJAAh+QQFFAAEACwHAAAADQAGAAADGhi6NP4BSBCauGLEWQfOm9R92kRZmLYozeMkACH5BAUUAAIALA4AAAAGAAYAAAIKjB+gYMu5WkSmAAA7" alt="loader" /> Cr\u00e9ation du planning...</p></section>'); m("/planning/general.json",function(a){g=a.root.planning;for(a=0;a<g.length;a++)if(p=new Date(1E3*g[a].date),p>n)for(var c=0;c<e.length;c++)if(g[a].url===e[c].url){var d=parseInt(g[a].season,10),j=e[c].season,k=parseInt(g[a].episode,10),m=e[c].episode;g[a].tvdb=e[c].tvdb;g[a].banner=e[c].banner;switch(q){case "0":if(d===j&&k===m||d===j&&k===m+1||d===j+1&&m===e[c].nbmax&&1===k)h.push(g[a]),++e[c].episode;break;case "1":(d===j&&k>=m||d>j)&&h.push(g[a]);break;case "2":h.push(g[a])}}f.empty();for(a=0;a< h.length;a++)p=new Date(1E3*h[a].date),w=p.getDate(),t=l[p.getMonth()],v=w.toString()+p.getMonth().toString(),0===b("#"+v).length&&(u=v===n.getDay().toString()+n.getMonth().toString()?"Aujourd'hui":w.toString()+" "+t.toString(),f.append('<section id="'+v+'" class="day"><h2>'+u+"</h2></section>")),b("#"+v).append("<div><h3>"+h[a].show+'</h3><img src="'+h[a].banner+'" alt="" /><span>Saison <em>'+h[a].season+"</em>, \u00e9pisode <em>"+h[a].episode+"</em></span><p>"+h[a].title+"</p><p>TV&nbsp;: "+h[a].tvdb+ "</p></div>");0===h.length&&f.append("<section><h2>Aucune diffusion</h2><p>Vous pouvez ajuster les \u00e9pisodes affich\u00e9s en modifiant vos options sur la page de compte.</p></section>")})}else y();x.on("click",H);B.on("click",I)})})(jQuery);